---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Préparation du téléchargement - GAMEASY">
  <main class="redirect-container">
    <div class="glass-card">
      <h1>Votre lien est <span>presque prêt</span></h1>
      <p>Le téléchargement sécurisé va commencer dans quelques secondes...</p>
      
      <div class="ad-slot">
        <p>Publicité</p>
        <div class="fake-ad"></div>
      </div>

      <div id="timer" class="countdown">15</div>

      <div class="button-wrapper">
        <a id="dl-link" class="download-button disabled" href="#">
          VEUILLEZ PATIENTER...
        </a>
      </div>
    </div>
  </main>
</Layout>

<script>
  const urlParams = new URLSearchParams(window.location.search);
  const finalUrl = urlParams.get('url');

  let timeLeft = 15;
  const timerElement = document.getElementById('timer');
  const linkElement = document.getElementById('dl-link');

  const countdown = setInterval(() => {
    timeLeft--;
    if (timerElement) timerElement.textContent = timeLeft.toString();

    if (timeLeft <= 0) {
      clearInterval(countdown);
      if (linkElement && finalUrl) {
        linkElement.textContent = "TÉLÉCHARGER MAINTENANT";
        linkElement.classList.remove('disabled');
        linkElement.href = finalUrl;
      }
    }
  }, 1000);
</script>

<style>
  .redirect-container {
    min-height: 80vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 120px 20px 60px;
    background: radial-gradient(circle at center, #1a1a2e 0%, #060612 100%);
  }

  .glass-card {
    background: rgba(255, 255, 255, 0.03);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(139, 92, 246, 0.3);
    padding: 3rem;
    border-radius: 20px;
    text-align: center;
    max-width: 600px;
    width: 90%;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    /* Ajout de box-sizing pour que le padding n'élargisse pas la carte */
    box-sizing: border-box; 
  }

  h1 span { color: #8b5cf6; }

  .countdown {
    font-size: 5rem;
    font-weight: 900;
    color: #8b5cf6;
    margin: 1.5rem 0;
    text-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
  }

  .button-wrapper {
    display: flex;
    justify-content: center;
    margin-top: 20px;
    width: 100%; /* S'assure que le wrapper prend toute la place */
  }

  .download-button {
    /* Changement de inline-block à flex pour mieux contrôler l'espace interne */
    display: flex;
    align-items: center;
    justify-content: center;
    
    /* On utilise une largeur de 100% pour coller à la case grise */
    width: 100%; 
    max-width: 500px; /* On limite pour ne pas qu'il soit trop géant sur grand écran */
    
    padding: 1.2rem 1rem;
    background: #8b5cf6;
    color: white;
    text-decoration: none;
    font-weight: 800;
    font-size: 1.1rem;
    text-transform: uppercase;
    border-radius: 12px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
    letter-spacing: 1px;
    
    /* IMPORTANT : empêche le bouton de dépasser à cause du padding */
    box-sizing: border-box; 
  }

  .download-button:not(.disabled):hover {
    transform: scale(1.02); /* Réduit légèrement le zoom pour éviter de toucher les bords */
    background: #7c3aed;
    box-shadow: 0 8px 25px rgba(139, 92, 246, 0.6);
  }

  .download-button:not(.disabled):active {
    transform: scale(0.98);
  }

  .download-button.disabled {
    background: #222;
    color: #555;
    cursor: not-allowed;
    pointer-events: none;
    box-shadow: none;
    border: 1px solid rgba(255,255,255,0.05);
  }

  .ad-slot {
    margin: 2rem 0;
    padding: 1rem;
    background: rgba(0,0,0,0.3);
    border: 1px dashed #444;
    /* On aligne la largeur de la pub sur le bouton */
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
    box-sizing: border-box;
  }

  .fake-ad { height: 100px; background: #000; border-radius: 8px; margin-top: 10px; }
</style>