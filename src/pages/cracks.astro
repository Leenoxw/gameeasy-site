---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

const games = [
  { id: 'gta-v', title: "GTA V", category: "Action / Open World", image: "/gameeasy-site/images/gta5.jpg" },
  { id: 'cyberpunk-2077', title: "Cyberpunk 2077", category: "RPG / Sci-Fi", image: "/gameeasy-site/images/cyberpunk.jpg" },
  { id: 'elden-ring', title: "Elden Ring", category: "Action / RPG", image: "/gameeasy-site/images/elden-ring.jpg" },
  { id: 'red-dead-redemption-2', title: "Red Dead Redemption 2", category: "Aventure / Western", image: "/gameeasy-site/images/rdr2.jpg" },
  { id: 'spiderman-2', title: "Marvel's Spider-Man 2", category: "Action / Aventure", image: "/gameeasy-site/images/spiderman2.jpg" },
  { id: 'hogwarts-legacy', title: "Hogwarts Legacy", category: "Aventure / Magie", image: "/gameeasy-site/images/hogwarts.jpg" },
  { id: 'forza-horizon-5', title: "Forza Horizon 5", category: "Course / Simulation", image: "/gameeasy-site/images/forza5.jpg" },
  { id: 'god-of-war-ragnarok', title: "God of War Ragnarök", category: "Action / Mythologie", image: "/gameeasy-site/images/gow-ragnarok.jpg" },
  { id: 'the-witcher-3', title: "The Witcher 3: Wild Hunt", category: "RPG / Fantasy", image: "/gameeasy-site/images/witcher3.jpg" },
  { id: 'hades-2', title: "Hades II", category: "Roguelike / Action", image: "/gameeasy-site/images/hades2.jpg" },
  { id: 'hollow-knight-silksong', title: "Hollow Knight: Silksong", category: "Metroidvania", image: "/gameeasy-site/images/silksong.jpg" },
  { id: 'manor-lords', title: "Manor Lords", category: "Stratégie / Médiéval", image: "/gameeasy-site/images/manor-lords.jpg" },
  { id: 'palworld', title: "Palworld", category: "Survie / Créatures", image: "/gameeasy-site/images/palworld.jpg" },
  { id: 'lethal-company', title: "Lethal Company", category: "Horreur / Coop", image: "/gameeasy-site/images/lethal-company.jpg" },
  { id: 'black-myth-wukong', title: "Black Myth: Wukong", category: "Action / RPG", image: "/gameeasy-site/images/wukong.jpg" },
  { id: 'stardew-valley', title: "Stardew Valley", category: "Simulation / RPG", image: "/gameeasy-site/images/stardew.jpg" },
  { id: 'schedules', title: "Schedules", category: "Indie / Horreur", image: "/gameeasy-site/images/schedules.jpg" },
  { id: 'are-we-there-yet', title: "Are We There Yet?", category: "Indie / Aventure", image: "/gameeasy-site/images/rv-there-yet.jpg" },
  { id: 'buckshot-roulette', title: "Buckshot Roulette", category: "Indie / Stratégie", image: "/gameeasy-site/images/buckshot.jpg" },
  { id: 'chained-together', title: "Chained Together", category: "Coop / Plateforme", image: "/gameeasy-site/images/chained-together.jpg" },
  { id: 'phasmophobia', title: "Phasmophobia", category: "Horreur / Coop", image: "/gameeasy-site/images/phasmophobia.jpg" }
];
---

<Layout title="Catalogue des Cracks - GameEasy">
  <Header />
  <main class="page-padding">
    <div class="container">
      <h1 class="title">TOUS LES <span class="purple">CRACKS</span></h1>
      <div class="line"></div>
      
      <p id="no-results" style="display: none; text-align: center; color: #888; margin-top: 50px; font-size: 1.2rem;">Aucun jeu ne correspond à votre recherche...</p>

      <div class="grid" id="gameGrid">
        {games.map((game) => (
          <div class="card game-card">
            <img src={game.image} alt={game.title} class="cover" />
            <div class="info">
              <span class="badge">{game.category}</span>
              <h3>{game.title}</h3>
              <a href={`/gameeasy-site/${game.id}`} class="btn">VOIR LE JEU</a>
            </div>
          </div>
        ))}
      </div>
    </div>
  </main>
  <Footer />
</Layout>

<script>
  function initSearch() {
    const searchInput = document.getElementById('mainSearch') as HTMLInputElement;
    const gameCards = document.querySelectorAll('.game-card');
    const noResults = document.getElementById('no-results');

    // 1. Détecter si une recherche est passée dans l'URL (?search=...)
    const urlParams = new URLSearchParams(window.location.search);
    const queryFromUrl = urlParams.get('search');

    const filterGames = (query: string) => {
      let hasMatch = false;
      const lowerQuery = query.toLowerCase();

      gameCards.forEach((card) => {
        const title = card.querySelector('h3').textContent.toLowerCase();
        if (title.includes(lowerQuery)) {
          (card as HTMLElement).style.display = "block";
          hasMatch = true;
        } else {
          (card as HTMLElement).style.display = "none";
        }
      });

      if (noResults) noResults.style.display = hasMatch ? "none" : "block";
    };

    // Si on vient de l'accueil avec un mot clé
    if (queryFromUrl && searchInput) {
      searchInput.value = queryFromUrl;
      filterGames(queryFromUrl);
    }

    // Écouter les changements en temps réel
    if (searchInput) {
      searchInput.addEventListener('input', (e) => {
        filterGames((e.target as HTMLInputElement).value);
      });
    }
  }

  initSearch();
  document.addEventListener('astro:after-swap', initSearch);
</script>

<style>
  .page-padding { padding: 140px 20px 120px; background: #060612; min-height: 100vh; color: white; }
  .container { max-width: 1200px; margin: 0 auto; }
  .title { text-align: center; font-size: 3rem; margin-bottom: 10px; font-weight: 900; letter-spacing: -1px; }
  .purple { color: #8a4fff; text-shadow: 0 0 20px rgba(138, 79, 255, 0.4); }
  .line { height: 4px; width: 60px; background: #8a4fff; margin: 0 auto 50px; border-radius: 10px; }
  
  .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; }
  .card { background: #11111e; border-radius: 16px; overflow: hidden; border: 1px solid rgba(255,255,255,0.05); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
  .card:hover { transform: translateY(-10px); border-color: #8a4fff; box-shadow: 0 15px 30px rgba(0,0,0,0.5); }
  
  .cover { width: 100%; height: 200px; object-fit: cover; border-bottom: 1px solid rgba(255,255,255,0.05); }
  .info { padding: 25px; }
  .badge { color: #8a4fff; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }
  h3 { margin: 12px 0 20px; font-size: 1.3rem; font-weight: 700; color: #fff; }
  
  .btn { display: block; background: #fff; color: #000; text-align: center; padding: 12px; border-radius: 10px; text-decoration: none; font-weight: 800; font-size: 0.9rem; transition: 0.3s; }
  .btn:hover { background: #8a4fff; color: white; transform: scale(1.02); }
</style>