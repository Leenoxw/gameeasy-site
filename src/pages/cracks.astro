---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { gamesData } from '../data/games.js';

const allGames = [...gamesData];
// On extrait les catégories uniques
const categories = ["Tous", ...new Set(allGames.map(game => game.cat.split(' / ')[0]))];
---

<Layout title="Catalogue des Cracks - GAMEASY">
  <Header />
  
  <main class="catalogue-page">
    <div class="container">
      <header class="cat-header">
        <h1>BIBLIOTHÈQUE <span class="purple">COMPLÈTE</span></h1>
        <p>Trouvez votre prochain jeu parmi nos {allGames.length} titres.</p>
      </header>

      <div class="filter-container">
        <div class="filter-group">
          <span class="filter-label">Genre :</span>
          <div class="filter-options" id="categoryFilters">
            {categories.map(cat => (
              <button class="filter-btn active-cat" data-type="cat" data-value={cat.toLowerCase()}>{cat}</button>
            ))}
          </div>
        </div>

        <div class="filter-group">
          <span class="filter-label">Mode :</span>
          <div class="filter-options" id="modeFilters">
            <button class="filter-btn active-mode" data-type="mode" data-value="tous">Tous</button>
            <button class="filter-btn" data-type="mode" data-value="solo">Solo</button>
            <button class="filter-btn" data-type="mode" data-value="multi">Multi</button>
          </div>
        </div>

        <div class="search-bar">
          <i class="fas fa-search"></i>
          <input type="text" id="gameSearch" placeholder="Rechercher un titre..." />
        </div>
      </div>

      <div class="game-grid" id="gameGrid">
        {allGames.map(game => (
          <a href={`/gameeasy-site/${game.id}`} 
             class="game-card" 
             data-title={game.title.toLowerCase()} 
             data-cat={game.cat.toLowerCase()}
             data-mode={game.mode.toLowerCase()}>
            <div class="card-inner">
              <div class="img-badges">
                <span class="badge cat">{game.cat.split(' / ')[0]}</span>
                <span class={`badge mode ${game.mode.toLowerCase().includes('multi') ? 'multi' : 'solo'}`}>
                  {game.mode}
                </span>
              </div>
              <img src={game.image} alt={game.title} />
              <div class="card-info">
                <h3>{game.title}</h3>
                <div class="card-footer">
                  <span class="status-ok">DISPONIBLE</span>
                  <span class="view-more">VOIR +</span>
                </div>
              </div>
            </div>
          </a>
        ))}
      </div>
    </div>
  </main>
  <Footer />
</Layout>

<script>
  const searchInput = document.getElementById('gameSearch') as HTMLInputElement;
  const cards = document.querySelectorAll('.game-card');
  const catBtns = document.querySelectorAll('[data-type="cat"]');
  const modeBtns = document.querySelectorAll('[data-type="mode"]');

  let activeCat = 'tous';
  let activeMode = 'tous';

  function filterGames() {
    const search = searchInput.value.toLowerCase();

    cards.forEach(card => {
      const title = card.getAttribute('data-title') || '';
      const cat = card.getAttribute('data-cat') || '';
      const mode = card.getAttribute('data-mode') || '';

      const matchSearch = title.includes(search);
      const matchCat = activeCat === 'tous' || cat.includes(activeCat);
      const matchMode = activeMode === 'tous' || mode.includes(activeMode);

      if (matchSearch && matchCat && matchMode) {
        (card as HTMLElement).style.display = 'block';
      } else {
        (card as HTMLElement).style.display = 'none';
      }
    });
  }

  // Gestion clics catégories
  catBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      catBtns.forEach(b => b.classList.remove('active-cat'));
      btn.classList.add('active-cat');
      activeCat = btn.getAttribute('data-value') || 'tous';
      filterGames();
    });
  });

  // Gestion clics Solo/Multi
  modeBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      modeBtns.forEach(b => b.classList.remove('active-mode'));
      btn.classList.add('active-mode');
      activeMode = btn.getAttribute('data-value') || 'tous';
      filterGames();
    });
  });

  searchInput.addEventListener('input', filterGames);
</script>

<style>
  .catalogue-page { padding: 140px 20px 80px; background: #060612; min-height: 100vh; color: white; }
  .container { max-width: 1300px; margin: 0 auto; }
  
  .cat-header { text-align: center; margin-bottom: 50px; }
  .cat-header h1 { font-size: 3.5rem; font-weight: 900; }
  .purple { color: #8a4fff; text-shadow: 0 0 15px rgba(138, 79, 255, 0.3); }

  /* Section Filtres */
  .filter-container { 
    background: #0c0c1d; padding: 30px; border-radius: 20px; 
    border: 1px solid rgba(255,255,255,0.05); margin-bottom: 40px;
    display: flex; flex-direction: column; gap: 20px;
  }
  .filter-group { display: flex; align-items: center; gap: 20px; flex-wrap: wrap; }
  .filter-label { font-weight: 800; color: #555; text-transform: uppercase; font-size: 0.8rem; width: 70px; }
  .filter-options { display: flex; gap: 10px; flex-wrap: wrap; }

  .filter-btn {
    background: #16162d; border: 1px solid #252545; color: #888;
    padding: 8px 18px; border-radius: 10px; cursor: pointer;
    font-weight: 700; font-size: 0.9rem; transition: 0.3s;
  }
  .filter-btn:hover { border-color: #8a4fff; color: white; }
  .filter-btn.active-cat, .filter-btn.active-mode { background: #8a4fff; color: white; border-color: #8a4fff; box-shadow: 0 5px 15px rgba(138, 79, 255, 0.3); }

  .search-bar { 
    background: #16162d; border: 1px solid #252545; padding: 12px 20px; 
    border-radius: 12px; display: flex; align-items: center; gap: 15px; margin-top: 10px;
  }
  .search-bar input { background: transparent; border: none; color: white; outline: none; width: 100%; font-size: 1rem; }
  .search-bar i { color: #8a4fff; }

  /* Grid & Cards */
  .game-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
  .game-card { text-decoration: none; transition: 0.4s ease; }
  .card-inner { background: #11111e; border-radius: 20px; overflow: hidden; border: 1px solid rgba(255,255,255,0.03); position: relative; }
  .game-card:hover { transform: translateY(-10px); }
  .game-card:hover .card-inner { border-color: #8a4fff; box-shadow: 0 15px 30px rgba(0,0,0,0.5); }

  .img-badges { position: absolute; top: 15px; left: 15px; display: flex; gap: 8px; z-index: 5; }
  .badge { padding: 5px 12px; border-radius: 8px; font-size: 0.7rem; font-weight: 900; color: white; text-transform: uppercase; }
  .badge.cat { background: rgba(138, 79, 255, 0.9); backdrop-filter: blur(5px); }
  .badge.mode.solo { background: #3498db; }
  .badge.mode.multi { background: #e67e22; }

  .card-inner img { width: 100%; aspect-ratio: 16/10; object-fit: cover; }
  .card-info { padding: 20px; }
  .card-info h3 { color: white; font-size: 1.3rem; font-weight: 800; margin-bottom: 15px; }
  
  .card-footer { display: flex; justify-content: space-between; align-items: center; }
  .status-ok { color: #00ff88; font-size: 0.75rem; font-weight: 800; }
  .view-more { color: #8a4fff; font-size: 0.8rem; font-weight: 900; }

  @media (max-width: 768px) {
    .cat-header h1 { font-size: 2.2rem; }
    .filter-group { flex-direction: column; align-items: flex-start; }
  }
</style>