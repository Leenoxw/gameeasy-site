---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

// Ces donn√©es seront remplac√©es par l'API une fois connect√©e
// Pour l'instant, c'est ta configuration de base
const targetAmount = 100;
---

<Layout title="Soutenir GAMEASY - Automation & S√©curit√©">
  <Header />
  
  <main class="donation-page">
    <div class="donation-wrapper">
      
      <aside class="side-ad left-ad">
        <div class="ad-sticky">
          <span class="ad-label">SPONSOR</span>
          <iframe data-aa='2425086' src='//acceptable.a-ads.com/2425086/?size=160x600' style='border:0; padding:0; width:160px; height:600px; overflow:hidden; background-color: transparent;'></iframe>
        </div>
      </aside>

      <div class="center-content">
        <div class="donation-card">
          <div class="card-header">
            <div class="icon-circle">‚ö°</div>
            <h1>SYST√àME DE DON AUTOMATIS√â</h1>
            <p>Soutenez GAMEASY. Vos dons sont d√©sormais trait√©s automatiquement via notre passerelle s√©curis√©e.</p>
          </div>

          <div class="goal-container">
            <div class="goal-header">
              <span class="goal-title">Objectif Maintenance</span>
              <span class="goal-value"><span id="current-val">0</span>‚Ç¨ / {targetAmount}‚Ç¨</span>
            </div>
            <div class="progress-track">
              <div class="progress-bar-fill" id="goal-bar" style="width: 0%;"></div>
            </div>
            <p class="goal-status">üöÄ <strong id="percent-text">0%</strong> collect√©s par la communaut√©.</p>
          </div>

          <div class="payment-methods">
            <h3>Choisir un montant</h3>
            <div class="payment-grid">
              <button class="pay-btn sellix" onclick="openSellix('5.00')">
                <i class="fas fa-coffee"></i> 5‚Ç¨ (Support)
              </button>
              <button class="pay-btn sellix highlight-pay" onclick="openSellix('10.00')">
                <i class="fas fa-heart"></i> 10‚Ç¨ (Premium)
              </button>
              <button class="pay-btn paypal" onclick="window.open('https://paypal.me/TON_PSEUDO/20', '_blank')">
                <i class="fab fa-paypal"></i> 20‚Ç¨ (Elite)
              </button>
            </div>
            <p class="automation-notice"><i class="fas fa-sync-alt fa-spin"></i> Traitement instantan√© via Sellix Cloud</p>
          </div>

          <div class="separator"><span>DERNIERS DONATEURS</span></div>

          <div class="donors-container">
            <div id="donors-list" class="donors-list">
                <div class="loading-dots">Chargement des dons en cours...</div>
            </div>
          </div>

          <div class="crypto-footer">
            <p>Besoin d'anonymat total ?</p>
            <div class="mini-crypto">
                <code>BTC: bc1qxy2kgdygj... <i class="fas fa-copy" onclick="copyToClipboard('bc1q...')"></i></code>
            </div>
          </div>
        </div>
      </div>

      <aside class="side-ad right-ad">
        <div class="ad-sticky">
          <span class="ad-label">SPONSOR</span>
          <iframe data-aa='2425087' src='//acceptable.a-ads.com/2425087/?size=160x600' style='border:0; padding:0; width:160px; height:600px; overflow:hidden; background-color: transparent;'></iframe>
        </div>
      </aside>

    </div>
  </main>

  <Footer />
</Layout>

<script is:inline define:vars={{ targetAmount }}>
  // SIMULATION DE L'API AUTOMATIQUE (√Ä connecter √† Sellix/Supabase)
  const mockData = {
    current: 68,
    donors: [
      { name: "Lukas_K", amount: 10, time: "Il y a 5 min" },
      { name: "Anonyme", amount: 5, time: "Il y a 1h" },
      { name: "X-Gamer", amount: 20, time: "Aujourd'hui" },
      { name: "Shadow", amount: 2, time: "Hier" }
    ]
  };

  function initAutomation() {
    const bar = document.getElementById('goal-bar');
    const currentText = document.getElementById('current-val');
    const percentText = document.getElementById('percent-text');
    const list = document.getElementById('donors-list');

    const percent = Math.round((mockData.current / targetAmount) * 100);

    // 1. Animer la barre et les chiffres
    setTimeout(() => {
        bar.style.width = percent + '%';
        currentText.innerText = mockData.current;
        percentText.innerText = percent + '%';
    }, 500);

    // 2. G√©n√©rer la liste des donateurs
    list.innerHTML = mockData.donors.map(don => `
      <div class="donor-row">
        <div class="d-left">
            <span class="d-avatar">${don.name.charAt(0)}</span>
            <span class="d-name">${don.name}</span>
        </div>
        <div class="d-right">
            <span class="d-amount">${don.amount}‚Ç¨</span>
            <span class="d-time">${don.time}</span>
        </div>
      </div>
    `).join('');
  }

  // Fonction pour Sellix (Ouvre leur checkout s√©curis√©)
  window.openSellix = (val) => {
    // Ici tu mettrais ton lien de produit Sellix
    alert("Redirection vers le paiement s√©curis√© de " + val + "‚Ç¨...");
    window.open('https://sellix.io/ton-shop', '_blank');
  }

  window.copyToClipboard = (text) => {
    navigator.clipboard.writeText(text);
    alert("Copi√© !");
  }

  document.addEventListener('DOMContentLoaded', initAutomation);
</script>

<style>
  .donation-page { min-height: 100vh; background: #060612; padding: 120px 20px 60px; color: white; }
  .donation-wrapper { display: flex; justify-content: center; gap: 40px; max-width: 1500px; margin: 0 auto; }

  /* PUBS */
  .side-ad { flex: 0 0 160px; }
  .ad-sticky { position: sticky; top: 100px; text-align: center; }
  .ad-label { display: block; font-size: 10px; color: #444; font-weight: 900; margin-bottom: 5px; letter-spacing: 2px; }

  /* CARTE CENTRALE */
  .center-content { flex: 1; max-width: 800px; }
  .donation-card { 
    background: #0c0c1d; border: 1px solid rgba(138, 79, 255, 0.15); border-radius: 40px; 
    padding: 50px; text-align: center; box-shadow: 0 30px 60px rgba(0,0,0,0.6);
  }

  .icon-circle { 
    width: 80px; height: 80px; background: rgba(138, 79, 255, 0.1); 
    border-radius: 50%; display: flex; align-items: center; justify-content: center; 
    margin: 0 auto 20px; font-size: 2.5rem; border: 1px solid #8a4fff;
  }

  h1 { font-size: 2.2rem; font-weight: 950; letter-spacing: -1px; margin-bottom: 10px; }
  p { color: #888; margin-bottom: 30px; }

  /* GOAL */
  .goal-container { background: rgba(255,255,255,0.02); padding: 30px; border-radius: 25px; margin-bottom: 40px; }
  .goal-header { display: flex; justify-content: space-between; margin-bottom: 15px; font-weight: 800; }
  .progress-track { height: 16px; background: #15152a; border-radius: 50px; overflow: hidden; }
  .progress-bar-fill { 
    height: 100%; background: linear-gradient(90deg, #8a4fff, #f97316); 
    box-shadow: 0 0 20px rgba(138, 79, 255, 0.4); transition: 2s cubic-bezier(0.2, 1, 0.2, 1); 
  }
  .goal-status { margin-top: 15px; font-size: 0.9rem; color: #555; }

  /* BOUTONS PAIEMENT */
  .payment-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 20px 0; }
  .pay-btn {