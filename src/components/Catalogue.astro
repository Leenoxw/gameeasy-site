---
import Card from './Card.astro';
import { gamesData } from '../data/games.js';
---

<div class="layout-ads">
    <aside class="side-ad left">
        <div class="ad-placeholder">PUB GAUCHE</div>
    </aside>

    <section class="catalogue-section">
        <div class="section-header">
            <div class="header-text">
                <h2>Derniers <span>Cracks</span></h2>
                <div class="line"></div>
            </div>
            
            <div class="search-container">
                <i class="fas fa-search"></i>
                <input type="text" id="search-input" placeholder="Rechercher un jeu...">
            </div>
        </div>

        <div class="grid" id="game-grid">
            {gamesData.map((game) => (
                <div class="game-item" data-title={game.title.toLowerCase()} data-cat={game.cat.toLowerCase()}>
                    <a href={`/gameeasy-site/games/${game.id}`} class="card-link">
                        <Card title={game.title} category={game.cat} image={game.image} />
                    </a>
                </div>
            ))}
        </div>

        <div class="pagination" id="pagination-controls">
            <button id="prev-page" class="pag-btn"><i class="fas fa-chevron-left"></i> Précédent</button>
            <div id="page-numbers" class="page-numbers"></div>
            <button id="next-page" class="pag-btn">Suivant <i class="fas fa-chevron-right"></i></button>
        </div>

        <div id="no-results" class="no-results" style="display: none;">
            <i class="fas fa-ghost"></i>
            <p>Aucun jeu trouvé pour votre recherche.</p>
        </div>
    </section>

    <aside class="side-ad right">
        <div class="ad-placeholder">PUB DROITE</div>
    </aside>
</div>

<script>
    const ITEMS_PER_PAGE = 18; // Nombre de jeux par page
    let currentPage = 1;
    let filteredItems: HTMLElement[] = [];

    const searchInput = document.getElementById('search-input') as HTMLInputElement;
    const gameGrid = document.getElementById('game-grid');
    const allItems = Array.from(document.querySelectorAll('.game-item')) as HTMLElement[];
    const prevBtn = document.getElementById('prev-page') as HTMLButtonElement;
    const nextBtn = document.getElementById('next-page') as HTMLButtonElement;
    const pageNumbersContainer = document.getElementById('page-numbers');
    const noResults = document.getElementById('no-results');

    function updateDisplay() {
        const searchValue = searchInput.value.toLowerCase().trim();
        
        // 1. Filtrer les items selon la recherche
        filteredItems = allItems.filter(item => {
            const title = item.getAttribute('data-title') || "";
            const cat = item.getAttribute('data-cat') || "";
            return title.includes(searchValue) || cat.includes(searchValue);
        });

        // 2. Calculer la pagination
        const totalPages = Math.ceil(filteredItems.length / ITEMS_PER_PAGE);
        if (currentPage > totalPages) currentPage = totalPages || 1;

        const start = (currentPage - 1) * ITEMS_PER_PAGE;
        const end = start + ITEMS_PER_PAGE;

        // 3. Masquer tout et afficher uniquement la page en cours
        allItems.forEach(item => item.style.display = 'none');
        filteredItems.slice(start, end).forEach(item => item.style.display = 'block');

        // 4. Gérer les boutons et messages
        if (noResults) noResults.style.display = filteredItems.length === 0 ? 'block' : 'none';
        if (prevBtn) prevBtn.disabled = currentPage === 1;
        if (nextBtn) nextBtn.disabled = currentPage === totalPages || totalPages === 0;
        
        renderPageNumbers(totalPages);
        
        // Cacher la pagination si un seul résultat ou aucun
        const pagControls = document.getElementById('pagination-controls');
        if(pagControls) pagControls.style.display = totalPages <= 1 ? 'none' : 'flex';
    }

    function renderPageNumbers(total: number) {
        if (!pageNumbersContainer) return;
        pageNumbersContainer.innerHTML = '';
        for (let i = 1; i <= total; i++) {
            const span = document.createElement('span');
            span.innerText = i.toString();
            span.className = `page-num ${i === currentPage ? 'active' : ''}`;
            span.onclick = () => { currentPage = i; updateDisplay(); window.scrollTo({top: 400, behavior: 'smooth'}); };
            pageNumbersContainer.appendChild(span);
        }
    }

    searchInput?.addEventListener('input', () => { currentPage = 1; updateDisplay(); });
    prevBtn?.addEventListener('click', () => { if (currentPage > 1) { currentPage--; updateDisplay(); window.scrollTo({top: 400, behavior: 'smooth'}); } });
    nextBtn?.addEventListener('click', () => { currentPage++; updateDisplay(); window.scrollTo({top: 400, behavior: 'smooth'}); });

    // Initialisation
    updateDisplay();
</script>

<style>
    /* ... Garde tes styles précédents pour le layout, grid, ads ... */
    
    .layout-ads { display: flex; justify-content: center; background: #060612; min-height: 100vh; }
    .catalogue-section { flex: 1; max-width: 1200px; padding: 40px 20px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 25px; margin-bottom: 50px; }

    /* PAGINATION STYLES */
    .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        margin-top: 40px;
        padding-bottom: 40px;
    }

    .pag-btn {
        background: rgba(138, 79, 255, 0.1);
        border: 1px solid #8a4fff;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.3s;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .pag-btn:hover:not(:disabled) {
        background: #8a4fff;
        box-shadow: 0 0 15px rgba(138, 79, 255, 0.4);
    }

    .pag-btn:disabled {
        opacity: 0.3;
        cursor: not-allowed;
        border-color: #444;
    }

    .page-numbers {
        display: flex;
        gap: 10px;
    }

    .page-num {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        cursor: pointer;
        transition: 0.3s;
        color: #ccc;
    }

    .page-num:hover { background: rgba(138, 79, 255, 0.2); color: white; }
    .page-num.active { background: #8a4fff; color: white; font-weight: bold; }

    /* Styles recherche */
    .search-container { position: relative; width: 100%; max-width: 300px; }
    .search-container i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #8a4fff; }
    .search-container input { width: 100%; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(138, 79, 255, 0.3); padding: 12px 15px 12px 40px; border-radius: 10px; color: white; outline: none; }
    
    /* ... Reste de tes styles ... */
</style>