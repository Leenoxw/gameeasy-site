---
import Card from './Card.astro';
import { gamesData } from '../data/games.js'; // On importe ta grande liste
---

<div class="layout-ads">
    <aside class="side-ad left">
        <div class="ad-placeholder">PUB GAUCHE</div>
    </aside>

    <section class="catalogue-section">
        <div class="section-header">
            <div class="header-text">
                <h2>Derniers <span>Cracks</span></h2>
                <div class="line"></div>
            </div>
            
            <div class="search-container">
                <i class="fas fa-search"></i>
                <input type="text" id="search-input" placeholder="Rechercher un jeu...">
            </div>
        </div>

        <div class="grid" id="game-grid">
            {gamesData.map((game) => (
                <div class="game-item" data-title={game.title.toLowerCase()} data-cat={game.cat.toLowerCase()}>
                    <a href={`/gameeasy-site/games/${game.id}`} class="card-link">
                        <Card title={game.title} category={game.cat} image={game.image} />
                    </a>
                </div>
            ))}
        </div>

        <div id="no-results" class="no-results" style="display: none;">
            <i class="fas fa-ghost"></i>
            <p>Aucun jeu trouvé pour votre recherche.</p>
        </div>
    </section>

    <aside class="side-ad right">
        <div class="ad-placeholder">PUB DROITE</div>
    </aside>
</div>

<script>
    const searchInput = document.getElementById('search-input') as HTMLInputElement;
    const gameItems = document.querySelectorAll('.game-item');
    const noResults = document.getElementById('no-results');

    if (searchInput) {
        searchInput.addEventListener('input', () => {
            const searchValue = searchInput.value.toLowerCase().trim();
            let hasResults = false;

            gameItems.forEach((item) => {
                const title = item.getAttribute('data-title');
                const category = item.getAttribute('data-cat');
                
                if (title?.includes(searchValue) || category?.includes(searchValue)) {
                    (item as HTMLElement).style.display = 'block';
                    hasResults = true;
                } else {
                    (item as HTMLElement).style.display = 'none';
                }
            });

            // Affiche le message "aucun résultat" si besoin
            if (noResults) {
                noResults.style.display = hasResults ? 'none' : 'block';
            }
        });
    }
</script>

<style>
    .layout-ads {
        display: flex;
        justify-content: center;
        background: #060612;
        min-height: 100vh;
    }

    .catalogue-section {
        flex: 1;
        max-width: 1200px;
        padding: 40px 20px;
    }

    /* Header du catalogue avec Recherche */
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        margin-bottom: 40px;
        flex-wrap: wrap;
        gap: 20px;
    }

    .search-container {
        position: relative;
        width: 100%;
        max-width: 300px;
    }

    .search-container i {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: #8a4fff;
    }

    .search-container input {
        width: 100%;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(138, 79, 255, 0.3);
        padding: 12px 15px 12px 40px;
        border-radius: 10px;
        color: white;
        outline: none;
        transition: 0.3s;
    }

    .search-container input:focus {
        border-color: #8a4fff;
        box-shadow: 0 0 15px rgba(138, 79, 255, 0.2);
    }

    /* Grille de jeux */
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 25px;
    }

    .card-link {
        text-decoration: none;
        display: block;
        transition: transform 0.3s;
    }

    .card-link:hover {
        transform: translateY(-5px);
    }

    /* Publicités */
    .side-ad {
        width: 220px;
        display: flex;
        justify-content: center;
        padding-top: 40px;
    }

    .ad-placeholder {
        width: 160px;
        height: 600px;
        background: rgba(255, 255, 255, 0.02);
        border: 1px dashed rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        color: rgba(255, 255, 255, 0.1);
        position: sticky;
        top: 100px;
    }

    /* Titres */
    h2 { font-size: 32px; color: white; margin: 0; }
    h2 span { color: #8a4fff; }
    .line { height: 3px; width: 50px; background: #8a4fff; margin-top: 8px; }

    .no-results {
        text-align: center;
        padding: 100px 0;
        color: #666;
    }
    .no-results i { font-size: 50px; margin-bottom: 20px; color: #8a4fff; }

    /* Responsive */
    @media (max-width: 1400px) {
        .side-ad { display: none; }
    }

    @media (max-width: 600px) {
        .section-header { flex-direction: column; align-items: flex-start; }
        .search-container { max-width: 100%; }
        .grid { grid-template-columns: 1fr; } /* Une seule colonne sur mobile pour plus de clarté */
    }
</style>